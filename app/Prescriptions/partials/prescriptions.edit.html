<navbar type="header">
  <li ng-if="!canvasEditable"><a ng-click="minimize();"><span class="glyphicon glyphicon-minus"></span></a></li>
  <li ng-if="!canvasEditable"><a ng-click="close()"><span class="glyphicon glyphicon-remove"></span></a></li>
</navbar>
<div cg-busy="myPromise"></div>
<div class="create-prescriptions" ng-init="canvasEditable=false;touched=false;">
  <form name="formPrescription" class="panel-group" novalidate ng-class="{'canvas-editable': canvasEditable}">
    <div class="diagnosis">
      <div ng-class="{'bg-diagnosis': !touched}" ng-show="canvasEnabled">
        <img class="img-diagnosis img-thumbnail" src="" ng-click="canvasEditable=true;touched=true;" uib-tooltip="Click to free write" tooltip-placement="top-left"/>
      </div>
    </div>
    <div pw-canvas options="{height: 620, color: '#000', undo: false, lineWidth: 1}" canvas-resize class="rx-canvas" ng-if="canvasEnabled">
    </div>

    <div ng-if="!canvasEnabled">
      <div class="form-group"  ng-class="{ 'has-error': formPrescription.patientComplaint.$touched && formPrescription.patientComplaint.$invalid }">
        <label for="patientComplaint">Patient Complaint*</label>
        <textarea class="form-control" name="patientComplaint" ng-model="prescription.patientComplaint" id="patientComplaint" rows="3" placeholder="Patient Complaint" required></textarea>
        <div class="help-block" ng-messages="formPrescription.patientComplaint.$error" ng-if="formPrescription.patientComplaint.$touched">
            <p ng-message="required">Patient Complaint is mandatory!</p>
        </div>
      </div>
      <div class="form-group" ng-class="{ 'has-error': formPrescription.diagnosis.$touched && formPrescription.diagnosis.$invalid }">
        <label for="diagnosis">Diagnosis*</label>
        <textarea class="form-control" name="diagnosis" ng-model="prescription.diagnosis" id="diagnosis" rows="4" placeholder="Diagnosis" required></textarea>
        <div class="help-block" ng-messages="formPrescription.diagnosis.$error" ng-if="formPrescription.diagnosis.$touched">
            <p ng-message="required">Patient Diagnosis is mandatory!</p>
        </div>
      </div>
    </div>
    <div class="medicines-list">
      <h4>Rx</h4>
      <hr>
      <medicines editable="true"></medicines>
    </div>

    <div class="row prescription-other">
      <div class="form-group col-md-2">
        <label for="nextVisit">Next Visit</label>
        <datetimepicker ng-model="prescription.nextVisit.date" id="nextVisit" placeholder="Schedule Next Visit"></datetimepicker>
      </div>
    </div>

  </form>
</div>

<button class="btn btn-danger canvas-new-page" ng-if="canvasEditable" uib-tooltip="Add new page">
    <i class="fa fa-plus"></i>
</button>
<navbar type="footer">
  <li class="navbar-li-custom">
    <div>
        <button type="button" class="btn btn-primary" ng-if="canvasEditable" ng-click="closeCanvas()" > 
            <span class="glyphicon glyphicon-ok"> </span>
        </button>
        <button type="button" class="btn btn-danger" ng-if="canvasEditable" ng-click="closeCanvas()" > 
            <span class="glyphicon glyphicon-remove"> </span>
        </button>
        <button type="button" class="btn btn-primary" ng-if="!canvasEditable" ng-click="save()"
                ng-disabled="formPrescription.$invalid">
            <i class="fa fa-floppy-o"></i> Save
        </button>
    </div>
  <li ng-if="!canvasEditable"><a ng-click="upsertMed()"><span class="glyphicon glyphicon-plus"></span> Add Medicine</a></li>
  <li ng-if="!canvasEditable"><a href="#"><span class="glyphicon glyphicon-plus"></span> Advises (Lab Tests)</a></li>
</navbar>
